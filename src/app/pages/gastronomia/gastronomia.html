<app-navbar></app-navbar>

<section class="page-hero gastronomia-hero">
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <div class="hero-pill">
            <span class="pill-icon"><i class="fas fa-utensils"></i></span>
            <span>Sabores auténticos</span>
        </div>
        <h1 class="page-title">
            Gastronomía de Andahuaylas
            <span>Sabores con historia, aroma a valle</span>
        </h1>
        <p class="page-subtitle">Platos ancestrales, cocinas creativas y experiencias que conectan con la tierra.</p>
        <div class="hero-meta">
            <span><i class="fas fa-map-marker-alt"></i> Valle del Chumbao</span>
            <span><i class="fas fa-leaf"></i> Ingredientes de altura</span>
        </div>
        <div class="hero-stats">
            @for (highlight of heroHighlights; track highlight.label) {
            <div class="stat-item">
                <span class="stat-number">{{ highlight.number }}</span>
                <span class="stat-label">{{ highlight.label }}</span>
            </div>
            }
        </div>
    </div>
</section>

<section class="filters-section">
    <div class="container">
        <div class="filters-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input 
                    type="text" 
                    placeholder="Buscar restaurantes, platos o bebidas..." 
                    [ngModel]="searchTerm()"
                    (ngModelChange)="searchTerm.set($event)"
                >
            </div>
            <div class="filter-buttons">
                @for (category of categories; track category.key) {
                <button
                    class="filter-btn"
                    [class.active]="selectedCategory() === category.key"
                    (click)="setCategory(category.key)"
                >
                    <i [class]="category.icon"></i> {{ category.label }}
                </button>
                }
            </div>
            <div class="price-filters">
                @for (price of priceFilters; track price.key) {
                <button
                    class="price-filter-btn"
                    [class.active]="selectedPrice() === price.key"
                    (click)="setPrice(price.key)"
                >
                    {{ price.label }}
                </button>
                }
            </div>
        </div>
        <div class="filters-summary" *ngIf="hasActiveFilters()">
            <p>Mostrando resultados filtrados.</p>
            <button class="chip clear" type="button" (click)="clearFilters()"><i class="fas fa-times"></i> Limpiar filtros</button>
        </div>
    </div>
</section>

<section class="featured-dishes">
    <div class="container">
        <div class="section-header">
            <div>
                <p class="section-eyebrow">Sabores insignia</p>
                <h2 class="section-title">
                    <i class="fas fa-star"></i>
                    Platos típicos destacados
                </h2>
            </div>
            <a class="btn ghost" routerLink="/reservas"><i class="fas fa-book"></i> Reservar experiencia</a>
        </div>
        <div class="dishes-slider">
            @for (dish of featuredDishes; track dish.id) {
            <article class="dish-card">
                <div class="dish-image">
                    <img [src]="dish.photo" [alt]="dish.name" loading="lazy">
                    <div class="dish-rating"><i class="fas fa-star"></i> {{ dish.rating | number:'1.1-1' }}</div>
                </div>
                <div class="dish-info">
                    <div class="dish-icon"><i [class]="dish.icon"></i></div>
                    <div>
                        <h3>{{ dish.name }}</h3>
                        <p>{{ dish.description }}</p>
                        <div class="dish-tags">
                            @for (tag of dish.tags; track tag) {
                            <span class="tag">{{ tag }}</span>
                            }
                        </div>
                    </div>
                </div>
            </article>
            }
        </div>
    </div>
</section>

<section class="establishments-grid">
    <div class="container">
        <div class="section-header">
            <div>
                <p class="section-eyebrow">Dónde comer y brindar</p>
                <h2 class="section-title">Restaurantes, bares y cafeterías</h2>
            </div>
            <p class="section-helper">{{ filteredEstablishments().length }} espacios seleccionados · Actualizado semanalmente</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading()" class="loading-state" style="text-align: center; padding: 3rem;">
            <i class="fas fa-spinner fa-spin fa-2x"></i>
            <p style="margin-top: 1rem;">Cargando establecimientos...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="error()" class="error-state" style="text-align: center; padding: 3rem; color: var(--error);">
            <i class="fas fa-exclamation-circle fa-2x"></i>
            <p style="margin-top: 1rem;">{{ error() }}</p>
            <button class="btn ghost" (click)="ngOnInit()">Intentar de nuevo</button>
        </div>

        <div class="establishments-container" *ngIf="!isLoading() && !error()">
            @for (place of filteredEstablishments(); track place.$id) {
            <article class="establishment-card">
                <div class="establishment-image">
                    <img [src]="place.imagen" [alt]="place.nombre" loading="lazy">
                    <span class="establishment-badge">{{ place.categoria | titlecase }}</span>
                    <span class="establishment-rating"><i class="fas fa-star"></i> {{ place.rating | number:'1.1-1' }}</span>
                </div>
                <div class="establishment-content">
                    <div class="establishment-header">
                        <div>
                            <h3 class="establishment-title">{{ place.nombre }}</h3>
                            <p class="establishment-category">{{ place.especialidades }}</p>
                        </div>
                        <span class="price-range">{{ place.nivelPrecio | titlecase }}</span>
                    </div>
                    <p class="establishment-description">{{ place.descripcion }}</p>
                    <div class="establishment-features">
                        @for (feature of getFeatures(place); track feature.label) {
                        <span class="feature-tag">
                            <i [class]="feature.icon"></i> {{ feature.label }}
                        </span>
                        }
                    </div>
                    <div class="establishment-info">
                        <div>
                            <p><i class="fas fa-map-marker-alt"></i> {{ place.ubicacion }}</p>
                            <p><i class="fas fa-clock"></i> {{ place.horario }}</p>
                        </div>
                        <a class="establishment-action" routerLink="/reservas"><i class="fas fa-calendar-plus"></i> Reservar</a>
                    </div>
                </div>
            </article>
            }
            <div class="empty-state" *ngIf="!filteredEstablishments().length">
                <div class="empty-icon"><i class="fas fa-utensils"></i></div>
                <h3>No encontramos coincidencias</h3>
                <p>Prueba con otro término o ajusta las categorías y precios.</p>
                <button class="btn ghost" type="button" (click)="clearFilters()"><i class="fas fa-sync"></i> Restablecer filtros</button>
            </div>
        </div>
    </div>
</section>

<section class="recommendations">
    <div class="container">
        <div class="section-header">
            <div>
                <p class="section-eyebrow">Experiencias</p>
                <h2 class="section-title">Tips para saborear Andahuaylas</h2>
            </div>
            <a class="btn btn-outline" routerLink="/contacto"><i class="fas fa-headset"></i> Hablar con un asesor</a>
        </div>
        <div class="recommendations-grid">
            @for (tip of experienceTips; track tip.id) {
            <article class="recommendation-card">
                <div class="recommendation-header">
                    <i [class]="tip.icon"></i>
                    <h3>{{ tip.title }}</h3>
                </div>
                <p>{{ tip.body }}</p>
            </article>
            }
        </div>
    </div>
</section>

<section class="cta-section">
    <div class="container">
        <div class="cta-content">
            <h2>¿Listo para una ruta gastronómica?</h2>
            <p>Diseñamos experiencias privadas con chefs locales, visitas a chacras y catas guiadas.</p>
            <div class="cta-buttons">
                <a class="cta-button primary" routerLink="/reservas"><i class="fas fa-calendar-alt"></i> Reservar ahora</a>
                <a class="cta-button secondary" routerLink="/contacto"><i class="fas fa-comments"></i> Solicitar propuesta</a>
            </div>
        </div>
    </div>
</section>

<app-footer></app-footer>
